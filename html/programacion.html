<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual de Usuario | Programacion</title>
    <link rel="stylesheet" href="../css/programacion.css">
    <link rel="shortcut icon" href="../image/libro.ico" type="image/x-icon">
    <link rel="stylesheet" href="../prismjs/prism.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100;0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>
<header>
    <div class="botones">
        <h1 id="tituloheader">Programacion</h1>
        <ul id="nav">
            <li><a href="../index.html">Inicio</a></li>
            <li><a href="materiales.html">Materiales</a></li>
            <li><a href="programacion.html">Programacion</a></li>
            <li><a href="montaje.html">Montaje</a></li>
            <li><a href="">Código de Activación</a></li>
            <li>
                <button id="buscarapa">Buscar</button>
            </li>
            <li>
                <form id="formularioBusqueda" action="resultado_busqueda.html" method="get" class="formulario">
                    <input type="text" name="busqueda" placeholder="Buscar">
                    <input type="submit" value="Buscar">
                </form>
            </li>
        </ul>
    </div>

    <script>
        var botonBuscar = document.getElementById("buscarapa");
        var formularioBusqueda = document.getElementById("formularioBusqueda");
        var navegador = document.getElementById("nav");


        botonBuscar.addEventListener("click", function () {
            formularioBusqueda.classList.add("mostrar");
            botonBuscar.classList.add("ocultar");
            navegador.style.left = "0%";

        });
    </script>
    <script>
        // Obtén el elemento con la clase "materiales"
        const elemento = document.querySelector(".materiales");

        // Obtén el botón oculto dentro del elemento
        const botonOculto = elemento.querySelector(".boton-oculto");

        // Añade un evento de hover al elemento
        elemento.addEventListener("mouseover", function () {
            // Muestra el botón oculto
            botonOculto.style.display = "block";
        });

        elemento.addEventListener("mouseout", function () {
            // Oculta el botón cuando se sale del hover
            botonOculto.style.display = "none";
        });
    </script>

</header>

<body>
    <div class="pagina">
        <div class="links" id="DESP">
            <button id="left"><i class="fa fa-angle-left"></i></button>
            <ul id="ul">
                <li><a href="#librerias">Librerias</a>
                    <ul id="dentro">
                        <li><a href="#libuti">Librerias Utilizadas en este proyecto</a>
                            <ul id="dentro">
                                <li><a href="#servo">Servo</a></li>
                                <li><a href="#liquid">LiquidCrystal I2C</a></li>
                                <li><a href="#keypad">Keypad</a></li>
                                <li><a href="#eeprom">EEPROM</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><a href="#setup">Funcion Setup</a>
                    <ul id="dentro">
                        <li><a href="#setupmanual">Funcion Setup para la Maquina Expendedora</a></li>
                    </ul>
                </li>
                <li><a href="#loop">Funcion Loop</a></li>
                <li><a href="#loading">Funcion Loading</a></li>
                <li><a href="#open">Funcion Open</a>
                <ul id="dentro">
                    <li>
                        <a href="#manual">Funcion Manual</a>
                    </li>
                </ul></li>
                <li><a href="#text">Funcion Text</a></li>
                <li><a href="#codigo">Funcion Codigo</a></li>
                <li><a href="#reboot">Funcion Reboot</a></li>
                <li><a href="#servfuc">Funcion ServoMotores</a></li>
                <li><a href="#savecode">Funcion Guardar Codigo Ingresado</a></li>
                <li><a href="#codecanj">Funcion Codigo Canjeado</a></li>
                <li><a href="#vercomponen">Verificacion de los componentes</a>
                <ul id="dentro">
                    <li><a href="#verkeypad">Verificar Keypad</a></li>
                    <li><a href="#verservo">Verificar Servo</a></li>
                </ul></li>
                <li><a href="#codecomplete">Codigo Completo</a></li>
            </ul>
        </div>
        <div class="programacion" id="programacion">
            <h1 id="librerias" class="titulo">Librerias</h1>
            <p id="parrafo">Las librerías de Arduino son conjuntos de código predefinido que proporcionan funciones y
                clases para
                realizar tareas específicas. Estas librerías permiten a los desarrolladores utilizar fácilmente
                diferentes componentes y periféricos, como sensores, actuadores, pantallas, módulos de comunicación y
                mucho más, sin tener que escribir todo el código desde cero.</p>
            <ul id="ulibrerias">
                <li>Librerías oficiales de Arduino: Estas librerías son mantenidas por el equipo de desarrollo de
                    Arduino y se incluyen en el entorno de desarrollo oficial (IDE) de Arduino. Proporcionan soporte
                    para funciones básicas, como el control de pines, la comunicación serial, el manejo de tiempos y
                    otros aspectos fundamentales.</li>
                <li>
                    Librerías de terceros: Existen numerosas librerías desarrolladas por la comunidad de Arduino que
                    abarcan una amplia variedad de funcionalidades. Estas librerías son creadas y mantenidas por
                    usuarios y desarrolladores externos, y cubren desde componentes y periféricos específicos hasta
                    protocolos de comunicación, algoritmos y servicios en la nube. Algunas librerías populares incluyen
                    "Adafruit", "LiquidCrystal", "Servo", "WiFiManager", "NeoPixel" y "Wire".
                </li>
            </ul>

            <p id="parrafo">Para utilizar una librería en Arduino, generalmente se debe descargar e instalar la librería
                correspondiente en el entorno de desarrollo. Luego, se incluye la librería en el código mediante una
                directiva #include y se utilizan las funciones y clases proporcionadas por la librería para lograr la
                funcionalidad deseada.

                Es importante tener en cuenta que, aunque las librerías pueden simplificar el desarrollo, es útil
                comprender el funcionamiento básico de los componentes y la programación de Arduino para utilizar las
                librerías de manera efectiva y solucionar problemas si es necesario.</p>
            <h2 id="libuti" class="titulo">Librerias Utilizadas en este proyecto</h2>
            <p id="parrafo">Estas son las tres librerias utilizadas en esta maquina:</p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    #include &lt;Servo.h&gt;
                    #include &lt;LiquidCrystal_I2C.h&gt;
                    #include &lt;EEPROM.h&gt;
                    #include &lt;Keypad.h&gt;
                  </code>
                </pre>
            <p id="parrafo">La libreria <strong>Servo</strong> es la libreria que controla los componentes de los servo
                motores, el <strong>LiquidCrystal_I2C</strong> es la libreria que controla el componente del mini
                controlador <strong>I2C</strong> para el <strong>LCD</strong>, la libreria <strong>EEPROM</strong> se
                encarga de escribir, leer, poner etc. En la memoria del arduino. Y por ultimo tenemos la libreria
                <strong>Keypad</strong> que controla el componente del panel numerico 4x4.
            </p>
            <p id="parrafo">Estas librerias tienen que estar configuradas antes de ser usadas, para configurar las
                librerias hay que declarar los pines que estan conectados a los componentes.</p>
            <h3 id="servo" class="titulo">Servo</h3>
            <p id="parrafo">Esta es la configuracion para los servo motores:</p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                #include &lt;Servo.h&gt;
                Servo motor1;
                Servo motor2;
                Servo motor3;

                void setup {
                    motor1.attach(12);
                    motor1.attach(11);
                    motor1.attach(10);
                }
              </code>
            </pre>
            <p id="parrafo">El parametro <strong>Servo</strong> es para declarar una instancia de la biblioteca Servo y
                controlar un motor de servo conectado a un pin especifico en la placa <strong>Arduino</strong>. El
                <strong>attach</strong> es para decir a la instancia a que pin esta conectado un servo motor, es
                importante que este en la funcion setup para asi cuando el arduino se inicie la instacia sepa que pin
                esta el servo motor.
            </p>
            <h3 id="liquid" class="titulo">LiquidCrystal I2C</h3>
            <p id="parrafo">Esta es la configuracion del LCD:</p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    #include &lt;LiquidCrystal_I2C.h&gt;

                    LiquidCrystal_I2C lcd(0x27, 16, 2);

                    void setup() {
                        lcd.init();
                        lcd.backlight();
                        lcd.clear();
                        lcd.begin(16, 2);
                        loading("Cargando");
                      }
                  </code>
                </pre>
            <p id="parrafo">El parametro <strong>LiquidCrystal_I2C</strong> es una instancia en Arduino para controlar
                una pantalla LCD, el parametro <strong>lcd</strong> es el nombre de la instancia, el parametro
                <strong>0x27</strong> es la direccion I2C de la pantalla <strong>LCD</strong>. Cada pantalla <strong>LCD
                    I2C</strong> tiene una direccion distinta pero la mas comun es la <strong>0x27</strong> pero aun asi
                puede ser diferente. El <strong>16</strong> es el numero de columnas que tiene la pantalla
                <strong>LCD</strong>.
                Indica cuántos caracteres o símbolos puede mostrar en una sola línea horizontal. El <strong>2</strong>
                es el numero de filas que tiene la pantalla <strong>LCD</strong>. Indica cuántas líneas de texto puede
                mostrar verticalmente.
            </p>
            <p id="parrafo">El <strong>lcd.init</strong> se utiliza para inicializar la communicacion con la pantalla
                LCD. El
                <strong>lcd.backlight</strong> se utiliza para encender la luz de fondo de la pantalla
                <strong>LCD</strong>. El
                <strong>lcd.clear</strong> se utiliza para borrar el contenido de la pantalla LCD y colocar el cursor en
                la posición
                inicial (esquina superior izquierda). El <strong>lcd.begin</strong> se utiliza para especificar el
                número de
                columnas y filas de la pantalla LCD. En este caso, se establece que la pantalla tiene 16 columnas y 2
                filas.
            </p>
            <h3 id="keypad" class="titulo">Keypad</h3>
            <p id="parrafo">Esta es la configuracion para el Keypad:</p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                #include &lt;Keypad.h&gt;

                const byte ROWS = 4;
                const byte COLS = 4;
                char keys[ROWS][COLS] = {
                  {'1','2','3','A'},
                  {'4','5','6','B'},
                  {'7','8','9','C'},
                  {'*','0','#','D'}
                };
                byte rowPins[ROWS] = {5, 4, 3, 2};
                byte colPins[COLS] = {9, 8, 7, 6};
                
                Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );
              </code>
            </pre>
            <p id="parrafo">
                El parametro <strong>const byte ROWS</strong> define el número de filas y <strong>const byte
                    COLS</strong> define el
                número de columnas del teclado numerico.
                El parametro <strong>char keys[ROWS][COLS]</strong> se define la matriz bidimensional llamada
                <strong>"keys"</strong> que representa las teclas del teclado numerico,
                cada matriz contiene el caracterer correspondiente a la tecla en la posición específica de la matriz.
                Estos
                parametros <strong>byte rowPins[ROWS] = {5, 4, 3, 2}</strong> y <strong>byte colPins[COLS] = {9, 8, 7,
                    6}</strong>
                son las filas y las columnas donde estan conectados los pines del teclado al arduino.
            </p>
            <pre rel="Arduino"><code class="language-arduino" style="white-space:pre-wrap;">
                Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );
              </code>
            </pre>
            <p id="parrafo">En esta linea de codigo crea una instancia de la clase <strong>Keypad</strong> con los
                parametros necesarios para configurar el teclado numerico.
                Se utiliza la clase <strong>Keypad</strong> para crear la instancia y se pasan a
                <strong>makeKeymap</strong> que indica la matriz de las teclas.
            </p>

            <h3 id="eeprom" class="titulo">EEPROM</h3>
            <p id="parrafo">
                El <strong>EEPROM</strong> en <strong>Arduino</strong> es una memoria no volátil que permite almacenar datos a largo
                plazo, incluso cuando se apaga la
                alimentación. Tiene un tamaño limitado (1 kilobyte en la mayoría de las placas) y se utiliza para guardar
                configuraciones y datos importantes. Puedes leer y escribir datos en el <strong>EEPROM</strong> utilizando la biblioteca
                <strong>EEPROM</strong>.h de
                <strong>Arduino</strong>. Sin embargo, ten en cuenta que el <strong>EEPROM</strong> tiene un número limitado de ciclos
                de escritura antes de desgastarse.
            </p>
            <p id="parrafo">
                Ejemplo:
            </p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
            #include <EEPROM.h>

                int address = 0;  // Dirección de memoria en el EEPROM
                
                void setup() {
                  // Inicia el EEPROM
                  EEPROM.begin();
                  
                  // Escribir un valor en el EEPROM
                  int value = 42;
                  EEPROM.write(address, value);
                  EEPROM.commit();
                }
                
                void loop() {
                  // Leer el valor almacenado en el EEPROM
                  int value = EEPROM.read(address);
                  

                  
                  delay(1000);
                }
            </code>
        </pre>

            <h1 class="titulo" id="setup">Funcion Setup</h1>
            <p id="parrafo">La función <strong>setup()</strong> en <strong>Arduino</strong> es una función especial que
                se ejecuta una vez al inicio del programa. Su
                propósito principal es realizar la configuración inicial de la placa <strong>Arduino</strong>.</p>
            <p id="parrafo">
                Estas son algunas de sus caracteristicas:
            </p>
            <ul id="ulibrerias">
                <li>La función <strong>setup()</strong> se ejecuta solo una vez al inicio del programa. </li>
                <li>
                    La función <strong>setup()</strong> se utiliza para realizar cualquier configuración necesaria antes
                    de que el programa comience
                    a funcionar. Esto puede incluir la inicialización de pines, configuración de comunicaciones,
                    establecimiento de
                    variables iniciales, configuración de bibliotecas y otros pasos de preparación.
                </li>
                <li>
                    En la función <strong>setup()</strong>, generalmente se configuran los pines de entrada o salida
                    según sea necesario. Esto se logra
                    utilizando funciones como <strong>pinMode()</strong> para establecer la dirección de los pines
                    (entrada o salida) y otras configuraciones
                    específicas de los pines.
                </li>
                <li>
                    Si se utilizan bibliotecas adicionales en el proyecto, la función <strong>setup()</strong> puede ser
                    el lugar adecuado para configurar y
                    preparar esas bibliotecas. Esto puede incluir la creación de instancias de objetos, establecimiento
                    de parámetros y
                    cualquier otro paso necesario para utilizar la funcionalidad de esas bibliotecas.
                </li>
            </ul>
            <h2 class="titulo" id="setupmanual">Funcion Setup para la Maquina Expendedora</h2>
            <p id="parrafo">
                Esta es la funcion <strong>setup</strong> que esta configurada para la Maquina Expendedora:
            </p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                        void setup() {
                            Serial.begin(9600);
                            motor1.attach(12);
                            motor2.attach(11);
                            motor3.attach(10);
                            lcd.init();
                            lcd.backlight();
                            lcd.clear();
                            lcd.begin(16, 2);
                            loading("Cargando");
                          }
                      </code>
                    </pre>
            <p id="parrafo">
                Esta funcion lo que hace es inicial el <strong>Serial</strong> en el puerto <strong>9600</strong> para
                ver si hay
                errores ademas declara las instancias de los motores a sus pines correspondientes, inicia todas las
                instancias de
                <strong>LCD</strong> y por ultimo inicia la funcion <strong>"loading"</strong> con el
                <strong>string</strong> Cargando.
            </p>
            <h1 id="loop" class="titulo">Funcion Loop</h1>
            <p id="parrafo">
                La funcion <strong>loop</strong> es una funcion especial que se ejecuta repetidamente despues de la
                funcion
                <strong>setup</strong> haya finalizado.
            </p>
            <p id="parrafo">
                Estas son algunas de sus caracteristicas:
            </p>
            <ul id="ulibrerias">
                <li>La función <strong>setup()</strong> se ejecuta solo una vez al inicio del programa. </li>
                <li>
                    La función <strong>loop()</strong> se ejecuta repetidamente en un ciclo continuo después de que la
                    función <strong>setup()</strong> haya
                    finalizado. Una vez que el código dentro de la función <strong>loop()</strong> se completa, se
                    repite desde el principio, creando un
                    bucle infinito hasta que la placa Arduino se apague o reinicie. Se ejecuta repetidamente en un ciclo
                    continuo después de
                    que la función <strong>setup()</strong> haya finalizado. Una vez que el código dentro de la función
                    <strong>loop()</strong> se completa, se repite desde
                    el principio, creando un bucle infinito hasta que la placa Arduino se apague o reinicie.
                </li>
                <li>
                    Dentro de la función <strong>loop()</strong>, se escribe el código que se ejecuta de forma continua
                    para realizar las tareas requeridas por el programa.
                </li>
                <li>
                    La función <strong>loop()</strong> permite a la placa Arduino responder a eventos externos o
                    internos.
                </li>
            </ul>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                void loop() {
                    // el codigo que quieres que se repita...
                  }
              </code>
            </pre>
            <h1 id="loading" class="titulo">Funcion Loading</h1>
            <p id="parrafo">
                La funcion <strong>loading</strong> lo que realiza es una animacion de carga en la pantalla <strong>LCD</strong> donde
                muestra puntos por cada segundo, cuando acaba la animacion llama a la funcion <strong>Open</strong>. 
            </p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                void loading(char msg[]) {
                    lcd.setCursor(0, 0); // Se establece en la posicion del cursos en la pantalla LCD en la columna 0 y fila 0.
                    lcd.print(msg); // Escribe el mensaje
                  
                    for (int i = 0; i < 9; i++) { // Es un bucle for que se repite hasta 9 veces comenzando desde el "i = 0" hasta "i = 8"
                      delay(1000); // Retraso de 1s
                      lcd.print("."); // Despues del retraso se imprime un punto en la pantalla LCD
                    }
                  
                    Open(); // Llama a la funcion Open();
                  }
              </code>
            </pre>
            <img src="../programacion-image/loading.png" alt="">
            <h1 id="open" class="titulo">Funcion Open</h1>
            <p id="parrafo">
                La funcion <strong>Open</strong> realiza una serie de acciones relacionadas con la pantalla <strong>LCD</strong> y la
                interacción del usuario utilizando el teclado numerico.
            </p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                void Open() {
                    lcd.clear(); // Limpiamos el lcd
                    static int positionCounter = 0; // declaramos una variable de 0 a la posicion de la letra
                    char key = ' '; // declaramos una variable que inicia con un valor de un espacion en blanco
                
                    key = text("1. Introducir Un Codigo", "Presionar", positionCounter); // Llama a la funcion text y pasa una informacion de texto que muestra las opciones del menú y un mensaje para indicar al usuario que presione una tecla ademas tambien pasa el valor de positioncounter
                
                    switch (key) { // es un interruptor que realiza diferentes acciones segun el valor de la key que es la tecla presionada por el usuario
                      case '1': // Si presiona 1 le llevara a otra funcion llamada codigo
                        lcd.clear();
                        lcd.setCursor(0, 0);
                        lcd.print("Presiono 1");
                        delay(2000);
                        lcd.setCursor(0, 1);
                        lcd.print("Ing Codigo");
                        delay(5000);
                        codigo();
                        break;
                    case '*':
                      lcd.clear();
                      lcd.setCursor(0, 0);
                      lcd.print("Mantenimiento");
                      lcd.setCursor(0, 1);
                      delay(5000);
                      lcd.print("*Leer manual*");
                      delay(5000);
                      lcd.clear();
                      lcd.setCursor(0, 0);
                      lcd.print("*Leer manual*");
                      lcd.setCursor(0, 1);
                      lcd.print("*Antes de Usar*");
                      delay(5000);
                      lcd.clear();
                      lcd.print("Contraseña:");
                      String password = "";
                      while (password.length() < 7) {
                      char key = keypad.getKey();
                      if (key != NO_KEY) {
                      password += key;
                      lcd.setCursor(password.length() - 1, 1);
                      lcd.print('*');
                    }
                    delay(100);
                  }
                  if (password == "1520A5B") {
                    manual();
                  } else {
                    lcd.clear();
                    lcd.print("Contraseña");
                    lcd.setCursor(0, 1);
                    lcd.print("incorrecta");
                    delay(5000);
                    reboot(); 
                  }
                  break;
                      default:
                        break;
                    }
                  }
                
              </code>
            </pre>
            <p id="parrafo">
                Esta funcion muestra un menu en la pantalla LCD y espera a que el usuario presione una tecla utilizando el teclado numerico. Segun la tecla presionada, se ejecuta diferentes opciones, como mostrar mensajes en la pantalla, esperar ciertos periodos de tiempo y llamar a otras funciones como <strong>codigo();</strong>.
            </p>
            <h2 id="manual" class="titulo">Funcion Manual</h2>
            <p id="parrafo">
                Es una funcion que incluye un menu secreto que se presiona con la tecla <strong>*</strong> del teclado numerico, y para
                entra a este menu tendras que poner una contraseña que es la siguiente: <strong>1520A5B</strong> si se introduce mal la
                contraseña se reiniciara el sistema, si se introduce bien la contraseña estaras dentro del menu de mantenimiento. Dentro
                del menu puedes seleccionar opciones como <strong>Borrar EEPROM</strong>, <strong>Reboot</strong> y <strong>Mostrar EEPROM</strong>.
            </p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                void manual() {
                    lcd.clear();
                    static int positionCounter = 0;
                    char key = ' ';
                    key = text("1. Borrar MEM   2. Reboot   3. Mostrar MEM", "Presionar", positionCounter);
                    
                    switch (key) {
                      case '1':
                        lcd.clear();
                        lcd.setCursor(0, 0);
                        lcd.print("Seguro?Y(A)/N(D)");
                        lcd.setCursor(0, 1);
                        char choice;
                        while (true) {
                          char keyPress = keypad.getKey();
                          if (keyPress == 'A' || keyPress == 'D') {
                            choice = keyPress;
                            break;
                          }
                          delay(100);
                        }
                  
                        lcd.print(choice);
                        delay(2000);
                  
                        switch (choice) {
                          case 'A':
                            lcd.clear();
                            lcd.setCursor(0, 0);
                            lcd.print("Borrando...");
                            borrarEPROM();
                            lcd.setCursor(0, 1);
                            delay(2000);
                            break;
                          case 'D':
                            lcd.clear();
                            lcd.setCursor(0, 0);
                            lcd.print("Volviendo...");
                            lcd.setCursor(0, 1);
                            delay(2000);
                            return;
                        }
                        break;
                        case '2':
                        lcd.clear();
                        lcd.setCursor(0, 0);
                        lcd.print("Reboot");
                        delay(5000);
                        reboot();
                        break;
                        case '3':
                        lcd.clear();
                        lcd.setCursor(0, 0);
                        lcd.print("Mostrar MEM");
                        delay(5000);
                        mostrarEEPROM();
                        break;
                    } 
                    delay(1000);
                  }
              </code>
            </pre>
            <p id="parrafo">Codigo de Borrar <strong>EEPROM:</strong></p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                void borrarEPROM() {
                    for (int i = 0 ; i < EEPROM.length() ; i++) {
                      EEPROM.write(i, 0);
                    }
                    lcd.clear();
                    lcd.print("Ha sido borrado");
                    delay(3000);
                    reboot();
                  }
              </code>
            </pre>
            <p id="parrafo">
                Esta funcion lo que hace es que pone todas las direcciones del EEPROM a 0.
            </p>
            <p id="parrafo">Codigo de Mostrar <strong>EEPROM:</strong></p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                void borrarEPROM() {
                    for (int i = 0 ; i < EEPROM.length() ; i++) {
                      EEPROM.write(i, 0);
                    }
                    lcd.clear();
                    lcd.print("Ha sido borrado");
                    delay(3000);
                    reboot();
                  }
              </code>
            </pre>
            <p id="parrafo">
                Para ver las direcciones del <strong>EEPROM</strong> tendras que conectar antes un ordenador con arduino para verlo en el serial.
            </p>
            <h1 id="text" class="titulo">Funcion Text</h1>
            <p id="parrafo">
                La funcion <strong>text</strong> muestra un mensaje en dos lineas en la pantalla <strong>LCD</strong> y espera a que el
                usuario presione una tecla utilizando el teclado numerico.
            </p>
            <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                char text(const String& linea1, const String& linea2, int& positionCounter) {
                    lcd.clear(); // Borra el contenido actual de la pantalla LCD 
                    char key = ' '; // Variable de key que esta en blanco
                    while (key != '1' && key != '2' && key != '3' && key != '4' && key != '5' && key != '6' && key != '7' && key != '8' && key != '9' && key != '0' && key != 'A' && key != 'B' && key != 'C' && key != 'D' && key != '*' && key != '#') { // Es un bucle hasta que no haya una tecla valida se repetira el bucle
                      lcd.clear(); // Borra el contenido
                      lcd.setCursor(0, 0); // Establece la posicion la columna 0 y fila 0 del lcd
                      lcd.print(linea1.substring(positionCounter)); // Imprime en la pantalla LCD una porcion de la primera linea del mensaje
                      lcd.setCursor(0, 1); // Establece la posicion la columna 0 y fila 1 del lcd
                      lcd.print(linea2 + ": " + String(key)); // Imprime en la pantalla LCD la segunda linea del mensaje y al lado de los puntos aparecera el valor actual de la tecla
                      delay(600); // Retraso de 600ms
                      key = keypad.getKey(); // Lee la tecla presionada
                      positionCounter++; // Sube el valor del positionCounter en 1 para mover la porcion del texto
                      if (positionCounter >= linea1.length()) { // Verifica si ha alcanzado o superado la longitud de la primera linea del mensaje, si es asi se pone otra vez a 0 la variable positionCounter
                        positionCounter = 0;
                      }
                    }
                  
                    return key; // Devuelve el valor de la tecla presionada fuera del bucle
                  }
              </code>
            </pre>
            <p id="parrafo">La funcion <strong>text</strong> muestra un mensaje en las 2 lineas de la pantalla <strong>LCD</strong>
                y espera a que el usuario presione una tecla usando el teclado numerico. Hasta que no haya una tecla valida se repetira el bucle. </p>
                <h1 id="codigo" class="titulo">Funcion Codigo</h1>
                <p id="parrafo">
                    Esta funcion <strong>codigo</strong> realiza una verificacion y uso del codigo ingresado por el usuario mediante el teclado numerico.
                </p>
                <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    String codigosDisponibles[] = {
                        "AAA54",
                        "BBB54",
                        "ABC87",
                        "BCB09",
                        "CCD77",
                        "CBC56",
                        "900AB",
                        "675CC",
                        "90A6D",
                        "CCC54"
                      };
                      
                      const int CODIGO_EEPROM_ADDRESS = 120;
                      
                      void codigo() {
                        lcd.clear();
                        lcd.setCursor(0, 0);
                        lcd.print("Ingrese codigo:");
                      
                        String codigo = "";
                        while (codigo.length() < 5) {
                          char key = keypad.getKey();
                          if (key) {
                            codigo += key;
                            lcd.setCursor(codigo.length() - 1, 1);
                            lcd.print("*");
                          }
                        }
                      
                        bool codigoValido = false;
                        bool codigoUtilizado = false;
                      
                        for (int i = 0; i < sizeof(codigosDisponibles) / sizeof(codigosDisponibles[0]); i++) {
                          if (codigo == codigosDisponibles[i]) {
                            codigoValido = true;
                            if (codigosDisponibles[i] == "") {
                              codigoUtilizado = true;
                            } else {
                              codigosDisponibles[i] = "";
                              guardarCodigoUtilizado(i);
                            }
                            break;
                          }
                        }
                      
                        if (codigoValido && !codigoUtilizado && !codigoCanjeado(codigo)) {
                      
                          guardarCodigoIngresado(codigo);
                      
                          lcd.clear();
                          lcd.print("Codigo valido");
                          delay(2000);
                          servomotores();
                        } else {
                          lcd.clear();
                          lcd.print("Codigo invalido");
                          delay(2000);
                        }
                        reboot();
                      }
                      
                  </code>
                </pre>
                <p id="parrafo">
                    El valor <strong>codigosDisponibles</strong> es donde van todos los codigos que tienen ser validos. La variable
                    <strong>CODIGO_EEPROM_ADDRESS</strong> nos permite almacenar en una direccion del <strong>EEPROM</strong> dentro de la placa <strong>arduino</strong> todos los
                    codigos ingresados para evitar que no se vuelvan a ingresar otra vez. La funcion solo aceptara los codigos de una maximo
                    de 5 caracteres, entonces cuando el usuario este ingresando el codigo en la pantalla <strong>LCD</strong> se ingresara a
                    la vez * en la linea de abajo. El bucle <strong>for</strong> nos permite verificar si el codigo ya ha sido ingresado o
                    coincide con algun codigo disponible si hay una coincidencia la variable <strong>codigoValido</strong> se pone en
                    verdadero y si el codigo disponible esta vacio se establece como <strong>codigoUtilizado</strong> en verdadero de lo
                    contrario se marca el codigo disponible como utilizado y si esta utilizado se llama a la funcion
                    <strong>guardarCodigoUtilizado()</strong>. Verifica recorriendo todos los codigos disponibles se verifica si el codigo
                    es valido y no utilizado antes si no ha sido canjeado entonces se llama a la funcion
                    <strong>guardarCodigoIngresado</strong> para guardarlo en el EEPROM y en el <strong>LCD</strong> se muestra codigo
                    valido durante 2s y se llaman a la funcion de los <strong>servomotores();</strong>. Si el codigo ingresado no es valido
                    porque no esta puesto bien o ya ha sido ingresado en la pantalla pondra "Codigo Invalido" y 2s despues se llamara a la funcion <strong>reboot();</strong>.
                </p>

                <p id="parrafo">
                    Permite al usuario ingresar un codigo de 5 caracteres utilizando un teclado numerico. Despues verifica si el codigo
                    ingresado es valido, si no ha sido utilizado previamente y no ha sido canjeado antes. Dependiendo de estas condiciones,
                    se realizan acciones adicionales, como marcar el código como utilizado, guardar el código ingresado o realizar acciones
                    relacionadas con los servomotores. También se muestra un mensaje en la pantalla <strong>LCD</strong> para informar al usuario si el
                    código es válido o no.
                </p>
                <h1 id="reboot" class="titulo">Funcion Reboot</h1>
                <p id="parrafo">
                    La funcion <strong>reboot</strong> reinicia el controlador <strong>arduino</strong>.
                </p>
                <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    void reboot() {
                        MCUSR = 0x80; 
                        asm volatile ("jmp 0"); 
                      }
                  </code>
                </pre>
                <p id="parrafo">
                    La linea MCUSR es una variable que registra el controlador que almacena la informacion sobre el origen de un reincio o
                    reset y el asm volatile es una instruccion que realiza un salto a la direccion de memoria 0, lo que efectivamente
                    reinicia el controlador.
                </p>
                <h1 id="servfuc" class="titulo">Funcion ServoMotores</h1>
                <p id="parrafo">
                    La funcion de <strong>servomotores</strong> se encarga de que el usuario elija que Articulo quiere sacar de la maquina, pueden sacar
                    hasta un maximo de 3 articulos.
                </p>
                <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    void servomotores() {
                        lcd.clear();
                        static int positionCounter = 0;
                        char key = ' ';
                      
                        key = text("1. Articulo 1   2. Articulo 2   3. Articulo 3", "Presionar", positionCounter);
                      
                        if (key == '1') {
                          lcd.clear();
                          lcd.setCursor(0, 0);
                          lcd.print("Presiono 1");
                          delay(2000);
                          lcd.setCursor(0, 1);
                          motor1.write(180);
                          lcd.print("Articulo 1");
                          delay(2000);
                          motor1.write(90);
                          delay(3000);
                          Open();
                        } else if (key == '2') {
                          lcd.clear();
                          lcd.setCursor(0, 0);
                          lcd.print("Presiono 2");
                          delay(2000);
                          lcd.setCursor(0, 1);
                          motor2.write(0);
                          lcd.print("Articulo 2");
                          delay(2000);
                          motor2.write(90);
                          delay(3000);
                          Open();
                          } else if (key == '3') {
                          lcd.clear();
                          lcd.setCursor(0, 0);
                          lcd.print("Presiono 3");
                          delay(2000);
                          lcd.setCursor(0, 1);
                          motor3.write(180);
                          lcd.print("Articulo 3");
                          delay(2000);
                          motor3.write(90);
                          delay(3000);
                          Open();
                        } else {
                          
                        }
                      }
                  </code>
                </pre>

                <p id="parrafo">
                    Esta funcion basicamente es un menu que muestra infinitamente las opciones hasta que el usuario no pulse una tecla
                    valida, si el usuario presiona una tecla valida se movera el motor para extraer el Articulo.
                </p>
                <h1 id="savecode" class="titulo">Funciones Guardar Codigo Ingresado</h1>
                <p id="parrafo">
                    La funcion <strong>guardarCodigoUtilizado</strong> se encarga de crear un espacio vacio para marcar la posicion correspondiente como codigo utilizado.
                </p>
                <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    void guardarCodigoUtilizado(int index) {
                        String emptyString = "";
                        for (int i = 0; i < emptyString.length(); i++) {
                          EEPROM.write(CODIGO_EEPROM_ADDRESS + index * emptyString.length() + i, emptyString[i]);
                        }
                      }
                  </code>
                </pre>
                <p id="parrafo">
                    La variable <strong>String</strong> llamada <strong>emptyString</strong> al principio esta vacia pero se utiliza para
                    remplazar el codigo utilzado en la memoria EEPROM. La sentencia <strong>for</strong> se utiliza para recorrer cada
                    caracter de <strong>emptyString</strong>, dentro del bucle de for tambien esta la funcion <strong>EEPROM.write</strong>,
                    esto lo que hace es escribir cada caracter de la variable en la memoria <strong>EEPROM</strong>. El codigo lo escribe en
                    la direccion calculada de esta sintaxis <strong>CODIGO_EEPROM_ADDRESS + index * emptyString.length() + i</strong> que se
                    almacena cada caracter del codigo proporcionado.
                </p>
                <p id="parrafo">
                    La funcion <strong>guardarCodigoIngresado</strong> recibe el codigo ingresado y busca una posicion vacia en la memoria <strong>EEPROM</strong> para guardarlo.
                </p>
                <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    void guardarCodigoIngresado(const String& codigo) {
                        int codigoIndex = CODIGO_EEPROM_ADDRESS / sizeof(String); // Calcula el indice inicial para guardar el codigo en el EEPROM
                      
                        while (true) { // El bucle se repetira hasta encontrar una posicion vacia en el EEPROM
                          String codigoEnEEPROM; // En esta variable se guarda el codigo ingresado
                          for (int i = 0; i < codigo.length(); i++) {
                            char byteValue = EEPROM.read(CODIGO_EEPROM_ADDRESS + codigoIndex * codigo.length() + i);
                            codigoEnEEPROM += byteValue;
                          }
                      
                          if (codigoEnEEPROM == "") { // Verifica si la posición en la EEPROM está vacía
                            for (int i = 0; i < codigo.length(); i++) { // Guarda el código ingresado en la posición vacía
                              EEPROM.write(CODIGO_EEPROM_ADDRESS + codigoIndex * codigo.length() + i, codigo[i]);
                            }
                            EEPROM.write(CODIGO_EEPROM_ADDRESS + codigoIndex * codigo.length() + codigo.length(), '\0'); 
                            break;
                          }
                          codigoIndex++; // Pasar a la siguiente posición de memoria en la EEPROM
                        }
                      }
                  </code>
                </pre>
                <p id="parrafo">
                    Busca una posición vacía en la memoria <strong>EEPROM</strong> para almacenar un código ingresado. Utiliza un bucle while y operaciones
                    de lectura/escritura en la memoria <strong>EEPROM</strong> para encontrar una posición vacía y guardar el código ingresado en esa
                    posición.
                </p>

                <!--Funcion Canjeado-->
                <h1 id="codecanj" class="titulo">Funcion Codigo Canjeado</h1>
                <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                    bool codigoCanjeado(const String& codigo) {
                        int codigoIndex = CODIGO_EEPROM_ADDRESS / sizeof(String);
                      
                        while (true) {
                          String codigoEnEEPROM;
                          for (int i = 0; i < codigo.length(); i++) {
                            char byteValue = EEPROM.read(CODIGO_EEPROM_ADDRESS + codigoIndex * codigo.length() + i);
                            codigoEnEEPROM += byteValue;
                          }
                      
                          // Verificar si el código almacenado en la EEPROM coincide con el código ingresado
                          if (codigoEnEEPROM == codigo) {
                            return true; // El código ya ha sido canjeado y está almacenado en la EEPROM
                          } else if (codigoEnEEPROM == "") {
                            return false; // El código no ha sido canjeado
                          }
                      
                          codigoIndex++; // Pasar a la siguiente posición de memoria en la EEPROM
                        }
                      }
                      
                </code></pre>
                <p id="parrafo">
                    Esta funcion <strong>codigoCanjeado</strong> para verificar un codigo en especifico ha sido canjeado y si esta dentro de
                    la memoria <strong>EEPROM</strong> entonces recorre todo el <strong>EEPROM</strong> ha encontrar coincidencias si
                    devuelve un <strong>true</strong>, entonces significa que el codigo ha sido canjeado, si devuelve un
                    <strong>false</strong> significa que no ha encontrado ninguna coincidencia, el codigo no ha sido canjeado.
                </p>


                <h1 id="vercomponen" class="titulo">Verificacion de los componentes</h1>
                <p id="parrafo">Para verificar si los componentes funcionan hemos hecho un codigo para verificar si los componentes
                    realizan alguna accion, realizan un par de acciones.</p>
                    <h2 id="verkeypad" class="titulo">
                        Verificar Keypad
                    </h2>
                    <p id="parrafo">
                        Para verificar que el keypad funciona, hemos hecho un codigo que cada vez que pulses una tecla se imprime en el serial
                    </p>
                    <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                        #include <Keypad.h>

                            const int ROW_NUM = 4; //4 filas
                            const int COLUMN_NUM = 4; //4 columnas
                            
                            char keys[ROW_NUM][COLUMN_NUM] = {
                              {'1','2','3', 'A'},
                              {'4','5','6', 'B'},
                              {'7','8','9', 'C'},
                              {'*','0','#', 'D'}
                            };
                            
                            byte pin_rows[ROW_NUM] = {9, 8, 7, 6}; //conectar pines de las filas
                            byte pin_column[COLUMN_NUM] = {5, 4, 3, 2}; //conectar pines de las columnas
                            
                            Keypad keypad = Keypad( makeKeymap(keys), pin_rows, pin_column, ROW_NUM, COLUMN_NUM );
                            
                            void setup(){
                              Serial.begin(9600);
                            }
                            
                            void loop(){
                              char key = keypad.getKey();
                            
                              if (key){
                                Serial.println(key);
                              }
                            }
                            
                          
                    </code></pre>
                    <h2 id="verservo" class="titulo">
                        Verificar Servo
                    </h2>
                    <p id="parrafo">
                        Para verificar que los servo funcionan ponemos que en el bucle loop ponemos que giren todo el rato los 3 servo motores.
                    </p>
                    <pre rel="Arduino"><code class="language-arduino line-numbers" style="white-space:pre-wrap;">
                        #include <Servo.h>

                            Servo servoMotor1;  // Crear un objeto de la clase Servo
                            Servo servoMotor2;
                            Servo servoMotor3;
                            
                            void setup() {
                              servoMotor1.attach(10);  // Asociar el objeto servoMotor al pin 10
                              servoMotor2.attach(11);  // Asociar el objeto servoMotor al pin 11
                              servoMotor3.attach(12);  // Asociar el objeto servoMotor al pin 12
                            }
                            
                            void loop() {
                              servoMotor1.write(180);  // Girar en una dirección
                              servoMotor2.write(180);
                              servoMotor3.write(180);
                              
                            }
                     </code></pre>
                     <p id="parrafo"></p>
                     <h1 id="codecomplete" class="titulo">Codigo Completo</h1>
                <!--<p id="parrafo"><a href="../archivos/codigomaquina1.ino">Descargar</a></p>-->
                <div class="boton">                <a href="../archivos/codigomaquina1.ino"><div class="button" data-tooltip="Size: 11kB">
                    <div class="button-wrapper">
                      <div class="text">Descargar</div>
                        <span class="icon">
                          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15V3m0 12l-4-4m4 4l4-4M2 17l.621 2.485A2 2 0 0 0 4.561 21h14.878a2 2 0 0 0 1.94-1.515L22 17"></path></svg>
                        </span>
                      </div>
                    </div></a>
                    <a id="arriba" href="">↑</a>
                </div>
        </div>
    </div>
    <script src="../prismjs/prism.js"></script>
    <script>
        Prism.plugins.toolbar.registerButton('select-code', function (env) {
            var button = document.createElement('button');
            button.innerHTML = 'Seleccionar Código';

            button.innerHTML = 'Seleccionar Código';

            button.addEventListener('click', function () {
                if (document.body.createTextRange) {
                    var range = document.body.createTextRange();
                    range.moveToElementText(env.element);
                    range.select();
                } else if (window.getSelection) {
                    var selection = window.getSelection();
                    var range = document.createRange();
                    range.selectNodeContents(env.element);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            });

            return button;
        });
    </script>
</body>
<footer>
    <div class="columna" id="columna1">
        <h1>Programacion</h1>
    </div>
    <div class="columna" id="columna2">
        <ul>
            <li><a href="../index.html">Inicio</a></li>
            <li><a href="materiales.html">Materiales</a></li>
            <li><a href="programacion.html">Programacion</a></li>
            <li><a href="montaje.html">Montaje</a></li>
            <li><a href="">Código de Activación</a></li>
        </ul>
    </div>
</footer>
<script>
    var desplegar = document.getElementById("left");
    var clasedesp = document.getElementById("DESP");
    var desaparecer = document.getElementById("ul");
    var page = document.getElementById("programacion");
    var isDesplegado = false;

    desplegar.addEventListener("click", function () {
        if (isDesplegado) {
            clasedesp.style.width = "20%";
            desplegar.style.left = "90%";
            desplegar.style.rotate = "-0deg";
            desaparecer.style.display = "block";
            clasedesp.style.overflowY = "scroll";
            page.style.marginLeft = "20%";
        } else {
            clasedesp.style.width = "2%";
            desplegar.style.left = "20%";
            desplegar.style.rotate = "-180deg";
            desaparecer.style.display = "none";
            clasedesp.style.overflowY = "hidden";
            page.style.marginLeft = "0%";
        }
        // Actualizar el estado
        isDesplegado = !isDesplegado;
    });
</script>
<script>
    window.addEventListener('scroll', function () {
        var links = document.querySelector('.links');
        var footer = document.querySelector('footer');
        var windowHeight = window.innerHeight;
        var footerPosition = footer.offsetTop;
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop + windowHeight >= footerPosition) {
            links.style.top = '-10%';
        } else if (scrollTop < footerPosition) {
            links.style.top = '10%';
        }
    });


</script>

</html>